<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Random Image Picker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 1rem;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    input, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: block;
    }
    .message {
      color: green;
      margin-bottom: 1rem;
    }
    .image-wrapper {
      position: absolute;
      cursor: grab;
    }
    .draggable {
      max-width: 200px;
      max-height: 200px;
      border: 2px solid #ccc;
      border-radius: 0.5rem;
      transition: transform 0.2s ease;
      display: block;
    }
	#rulesContainer {
	  position: fixed;
	  top: 1rem;
	  right: 1rem;
	  max-width: 300px;
	  max-height: 90vh;
	  overflow-y: auto;
	  display: none;
	  padding: 1rem;
	  background: #fff;
	  border: 2px dashed #aaa;
	  border-radius: 10px;
	  z-index: 9999; /* <<< highest layer */
	}
    #rulesContainer img {
      max-width: 100%;
      max-height: 300px;
      margin-bottom: 0.5rem;
      display: block;
    }
  </style>
</head>
<body>

<h1>Random Image Picker</h1>

<input id="fileInput" type="file" multiple accept="image/*" />
<button id="showRulesButton">Show Rules</button>
<button id="drawButton" disabled>Draw A Card</button>
<p class="message" id="message"></p>

<div id="rulesContainer"></div>

<script>
  const fileInput = document.getElementById('fileInput');
  const drawButton = document.getElementById('drawButton');
  const showRulesButton = document.getElementById('showRulesButton');
  const message = document.getElementById('message');
  const rulesContainer = document.getElementById('rulesContainer');

  let images = [];
  let rules = [];
  let zIndexCounter = 1;

  fileInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files);
    rules = [];
    images = [];

    files.forEach(file => {
      const url = URL.createObjectURL(file);
      const isRule = file.name.toLowerCase().includes("rule");
      if (isRule) {
        rules.push({ name: file.name, url });
      } else {
        images.push(url);
      }
    });

    drawButton.disabled = images.length === 0;

    const skippedCount = files.length - images.length;
    message.textContent = skippedCount > 0
      ? `${skippedCount} rule image(s) loaded for 'Show Rules'.`
      : '';
  });

  drawButton.addEventListener('click', () => {
    if (images.length === 0) {
      message.textContent = "No images left! Please add more.";
      return;
    }
    const randomIndex = Math.floor(Math.random() * images.length);
    const imgSrc = images[randomIndex];
    images.splice(randomIndex, 1);
    createDraggableImage(imgSrc);

    if (images.length === 0) {
      message.textContent = "That was the last image!";
      drawButton.disabled = true;
    } else {
      message.textContent = `${images.length} image(s) remaining.`;
    }
  });

showRulesButton.addEventListener('click', () => {
  // Toggle visibility
  const isVisible = rulesContainer.style.display === 'block';

  if (!isVisible) {
    rulesContainer.innerHTML = ''; // Clear previous content

    if (rules.length === 0) {
      rulesContainer.textContent = "No rule images loaded.";
    } else {
      rules.forEach(rule => {
        const img = document.createElement('img');
        img.src = rule.url;
        img.alt = rule.name;
        rulesContainer.appendChild(img);
      });
    }
    rulesContainer.style.display = 'block'; // Show after populating
  } else {
    rulesContainer.style.display = 'none'; // Hide
  }
});


  function createDraggableImage(src) {
    const wrapper = document.createElement('div');
    wrapper.classList.add('image-wrapper');

    const img = document.createElement('img');
    img.src = src;
    img.classList.add('draggable');
    img.dataset.rotation = 0;
    wrapper.appendChild(img);
    document.body.appendChild(wrapper);

    const rect = drawButton.getBoundingClientRect();
    wrapper.style.left = rect.left + 'px';
    wrapper.style.top = rect.bottom + 10 + 'px';
    wrapper.style.zIndex = zIndexCounter++;

    let offsetX = 0;
    let offsetY = 0;
    let isDragging = false;
    let mouseDownTime = 0;
    let moved = false;

    img.addEventListener('mousedown', (e) => {
      if (e.button !== 0) return;
      isDragging = true;
      mouseDownTime = Date.now();
      moved = false;
      offsetX = e.clientX - wrapper.offsetLeft;
      offsetY = e.clientY - wrapper.offsetTop;
    });

    document.addEventListener('mouseup', (e) => {
      if (isDragging) {
        isDragging = false;
        if (e.button === 0) {
          const mouseUpTime = Date.now();
          if (mouseUpTime - mouseDownTime < 200 && !moved) {
            let currentRotation = parseInt(img.dataset.rotation, 10);
            currentRotation = (currentRotation + 90) % 360;
            img.dataset.rotation = currentRotation;
            img.style.transform = `rotate(${currentRotation}deg)`;
          }
        }
      }
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        moved = true;
        wrapper.style.left = e.clientX - offsetX + 'px';
        wrapper.style.top = e.clientY - offsetY + 'px';
      }
    });

    img.addEventListener('dblclick', () => {
      wrapper.style.zIndex = ++zIndexCounter;
    });

    img.ondragstart = () => false;
  }
</script>

</body>
</html>
