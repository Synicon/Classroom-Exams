<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Random Image Picker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 1rem;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
	  min-width: 1024px;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    input, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: block;
    }
    .message {
      color: green;
      margin-bottom: 1rem;
    }
    .image-wrapper {
      position: absolute;
      cursor: grab;
    }
    .draggable {
      max-width: 200px;
      max-height: 200px;
      border: 2px solid #ccc;
      border-radius: 0.5rem;
      transition: transform 0.2s ease;
      display: block;
    }
	#rulesContainer {
	  position: fixed;
	  top: 50%;
	  left: 50%;
	  transform: translate(-50%, -50%);
	  max-width: 90vw;
	  max-height: 90vh;
	  overflow-y: auto;
	  display: none;
	  padding: 1rem;
	  background: #fff;
	  border: 2px dashed #aaa;
	  border-radius: 10px;
	  z-index: 9999;
	  box-shadow: 0 0 20px rgba(0,0,0,0.3);
	}
    #rulesContainer img {
      max-width: 100%;
      max-height: 80%;
      margin-bottom: 0.5rem;
      display: block;
    }
	.rules-zoomable {
	  transition: transform 0.2s ease;
	  transform-origin: center center;
	}

  </style>
</head>
<body>

<h1>Random Image Picker</h1>

<input id="fileInput" type="file" multiple accept="image/*" />
<button id="showRulesButton">Show Rules</button>
<button id="drawButton" disabled>Draw A Card</button>
<p class="message" id="message"></p>

<div id="rulesContainer"></div>

<script>
  const fileInput = document.getElementById('fileInput');
  const drawButton = document.getElementById('drawButton');
  const showRulesButton = document.getElementById('showRulesButton');
  const message = document.getElementById('message');
  const rulesContainer = document.getElementById('rulesContainer');
  const defaultImageFiles = [
  "D0001.png",
  "D0002.png",
  "D0003.png",
  "D0004.png",
  "D0005.png",
  "D0006.png",
  "D0007.png",
  "D0008.png",
  "D0009.png",
  "D0010.png",
  "D0011.png",
  "D0012.png",
  "D0013.png",
  "D0014.png",
  "D0015.png",
  "D0016.png",
  "D0017.png",
  "D0018.png",
  "D0019.png",
  "D0020.png",
  "D0021.png",
  "D0022.png",
  "D0023.png",
  "D0024.png",
  "D0025.png",
  "D0026.png",
  "D0027.png",
  "D0028.png",
  "D0029.png",
  "D0030.png",
  "D0031.png",
  "D0032.png",
  "D0033.png",
  "D0034.png",
  "D0035.png",
  "D0036.png",
  "S0001.png",
  "S0002.png",
  "S0003.png",
  "S0004.png",
  "S0005.png",
  "S0006.png",
  "rules.png",
  ];

// Load default images on page load
window.addEventListener('DOMContentLoaded', () => {
  defaultImageFiles.forEach(fileName => {
	const url = `aMIX/${fileName}`;
	if (fileName.toLowerCase().includes('rule')) {
	  rules.push({ name: fileName, url });
	} else {
	  images.push(url);
	}
  });

  drawButton.disabled = images.length === 0;

  if (rules.length > 0) {
	message.textContent = `${rules.length} rule image(s) preloaded from 'aMix'.`;
  }
});

  let images = [];
  let rules = [];
  let zIndexCounter = 1;

  fileInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files);
    rules = [];
    images = [];

    files.forEach(file => {
      const url = URL.createObjectURL(file);
      const isRule = file.name.toLowerCase().includes("rule");
      if (isRule) {
        rules.push({ name: file.name, url });
      } else {
        images.push(url);
      }
    });

    drawButton.disabled = images.length === 0;

    const skippedCount = files.length - images.length;
    message.textContent = skippedCount > 0
      ? `${skippedCount} rule image(s) loaded for 'Show Rules'.`
      : '';
  });

  drawButton.addEventListener('click', () => {
    if (images.length === 0) {
      message.textContent = "No images left! Please add more.";
      return;
    }
    const randomIndex = Math.floor(Math.random() * images.length);
    const imgSrc = images[randomIndex];
    images.splice(randomIndex, 1);
    createDraggableImage(imgSrc);

    if (images.length === 0) {
      message.textContent = "That was the last image!";
      drawButton.disabled = true;
    } else {
      message.textContent = `${images.length} image(s) remaining.`;
    }
  });

showRulesButton.addEventListener('click', () => {
  // Toggle visibility
  const isVisible = rulesContainer.style.display === 'block';

  if (!isVisible) {
    rulesContainer.innerHTML = ''; // Clear previous content

    if (rules.length === 0) {
      rulesContainer.textContent = "No rule images loaded.";
    } else {
      rules.forEach(rule => {
        const img = document.createElement('img');
			img.src = rule.url;
			img.alt = rule.name;
			img.classList.add('rules-zoomable');
			img.dataset.scale = 1;

			img.addEventListener('wheel', (e) => {
			  e.preventDefault();
			  let scale = parseFloat(img.dataset.scale);
			  const delta = e.deltaY > 0 ? -0.1 : 0.1;
			  scale = Math.min(3, Math.max(0.5, scale + delta)); // clamp between 0.5x and 3x
			  img.dataset.scale = scale.toFixed(2);
			  img.style.transform = `scale(${scale})`;
			});

		rulesContainer.appendChild(img);
      });
    }
    rulesContainer.style.display = 'block'; // Show after populating
  } else {
    rulesContainer.style.display = 'none'; // Hide
  }
});


function createDraggableImage(src) {
  const wrapper = document.createElement('div');
  wrapper.classList.add('image-wrapper');

  const img = document.createElement('img');
  img.src = src;
  img.classList.add('draggable');
  img.dataset.rotation = 0;
  wrapper.appendChild(img);
  document.body.appendChild(wrapper);

  const rect = drawButton.getBoundingClientRect();
  wrapper.style.left = rect.left + 'px';
  wrapper.style.top = rect.bottom + 10 + 'px';
  wrapper.style.zIndex = zIndexCounter++;

  let offsetX = 0;
  let offsetY = 0;
  let isDragging = false;
  let moved = false;
  let dragStartTime = 0;

  const startDrag = (x, y) => {
    isDragging = true;
    moved = false;
    dragStartTime = Date.now();
    offsetX = x - wrapper.offsetLeft;
    offsetY = y - wrapper.offsetTop;
  };

  const doDrag = (x, y) => {
    if (isDragging) {
      moved = true;
      wrapper.style.left = (x - offsetX) + 'px';
      wrapper.style.top = (y - offsetY) + 'px';
    }
  };

  const endDrag = () => {
    if (!isDragging) return;
    isDragging = false;

    const elapsed = Date.now() - dragStartTime;
    if (elapsed < 200 && !moved) {
      // Rotate 90 degrees
      let currentRotation = parseInt(img.dataset.rotation, 10);
      currentRotation = (currentRotation + 90) % 360;
      img.dataset.rotation = currentRotation;
      img.style.transform = `rotate(${currentRotation}deg)`;
    }
  };

  // ===== Mouse Events =====
  img.addEventListener('mousedown', (e) => {
    if (e.button !== 0) return;
    e.preventDefault();
    startDrag(e.clientX, e.clientY);
  });

  document.addEventListener('mousemove', (e) => {
    doDrag(e.clientX, e.clientY);
  });

  document.addEventListener('mouseup', () => {
    endDrag();
  });

  // ===== Touch Events =====
  img.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      e.preventDefault();
      const touch = e.touches[0];
      startDrag(touch.clientX, touch.clientY);
    }
  }, { passive: false });

  document.addEventListener('touchmove', (e) => {
    if (e.touches.length === 1 && isDragging) {
      e.preventDefault();
      const touch = e.touches[0];
      doDrag(touch.clientX, touch.clientY);
    }
  }, { passive: false });

  document.addEventListener('touchend', () => {
    endDrag();
  });

  img.addEventListener('dblclick', () => {
    wrapper.style.zIndex = ++zIndexCounter;
  });

  img.addEventListener('contextmenu', e => e.preventDefault()); // Block long-press menu
  img.ondragstart = () => false;
}


  
  
</script>

</body>
</html>
